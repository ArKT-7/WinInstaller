#!/sbin/bash
#
# Copyright (C) 2023-24 https://github.com/Kumar-Jy
#
# Made for WINDOWS Installation on ............ 
#
ui_print "*************************************************";
ui_print "* Welcome to Windows Installation on .......... *";
ui_print "*         This Script is only for ....          *";
ui_print "*                Made by Kumar_Jy               *";
ui_print "*       Telegram : https://t.me/Kumar_Jy        *";
ui_print "*      Github : https://github.com/Kumar-Jy     *";
ui_print "*************************************************";
ui_print "*            Installation Process Start         *";
ui_print "*************************************************";
ui_print "*  extracting boot and modem to /cache/backup   *";
mkdir /cache/backup
dd if=/dev/block/by-name/boot of=/cache/backup/boot.img
dd if=/dev/block/by-name/fsc of=/cache/backup/fsc
dd if=/dev/block/by-name/fsg of=/cache/backup/fsg
dd if=/dev/block/by-name/modemst1 of=/cache/backup/modemst1
dd if=/dev/block/by-name/modemst2 of=/cache/backup/modemst2
ui_print "*               Unmounting Partition            *";
umount /dev/block/by-name/win
umount /dev/block/by-name/pe
sleep 1
ui_print "*************************************************";
ui_print "*                Formating Partition            *";
mkfs.fat -F32 -s1 /dev/block/by-name/esp -n ESP
mkfs.fat -F32 -s1 /dev/block/by-name/pe -n PE
mkfs.ntfs -f /dev/block/by-name/win -L WIN
sleep 1
ui_print "*************************************************";
ui_print "*               Mounting Partition              *";
mkdir /mnt/win
mkdir /mnt/pe
mount.ntfs /dev/block/by-name/win /mnt/win
mount /dev/block/by-name/pe /mnt/pe
sleep 1
ui_print "*************************************************";
ui_print "*              Copy Installation File           *";
mkdir /mnt/win/installer
mkdir /mnt/win/installer/Driver
mkdir /mnt/win/Sta
package_extract_file "Driver.zip" "/mnt/win/installer/Driver.zip";
package_extract_file "WinPE.zip" "/mnt/win/installer/WinPE.zip";
package_extract_file "Sta.zip" "/mnt/win/installer/Sta.zip";
package_extract_file "uefi.img" "/mnt/win/installer/uefi.img";
package_extract_file "install.esd" "/mnt/win/installer/install.esd";
package_extract_file "winactivator.bat" "/mnt/win/winactivator.bat";
unzip /mnt/win/installer/WinPE.zip -d /mnt/pe
unzip /mnt/win/installer/Driver.zip -d /mnt/win/installer/Driver
unzip /mnt/win/installer/Sta.zip -d /mnt/win/Sta
sleep 1
ui_print "*************************************************";
ui_print "*     flashing uefi image to boot partition     *";
cp -r /cache/backup /sdcard
cp /cache/backup/boot.img -d /mnt/win/boot.img
dd if=/mnt/win/installer/uefi.img of=/dev/block/by-name/boot
sleep 1
ui_print "*************************************************";
ui_print "*               Flashing Completed              *";
ui_print "*                                               *";
ui_print "*save backup folder from phone to SdCard/PenDriv*";
ui_print "*                                               *";
ui_print "*           rebooting in 10 sec and             *";
ui_print "*                                               *";
ui_print "*     Installation will start automaticly       *";
ui_print "*                                               *";
ui_print "*  If Installation Failed, Don't Flash it again *";
ui_print "*                                               *";
ui_print "*         ask for help on Telegram Chat         *";
ui_print "*                                               *";
ui_print "*************************************************";
sleep 10
reboot
