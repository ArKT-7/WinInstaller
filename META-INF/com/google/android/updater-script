#!/sbin/bash
#
# Copyright (C) 2023-24 https://github.com/Kumar-Jy
#
# Made for WINDOWS Installation on ............ 
#
ui_print "*************************************************";
ui_print "* Welcome to Windows Installation on .......... *";
ui_print "*         This Script is only for ....          *";
ui_print "*                Made by Kumar_Jy               *";
ui_print "*       Telegram : https://t.me/Kumar_Jy        *";
ui_print "*      Github : https://github.com/Kumar-Jy     *";
ui_print "*************************************************";
ui_print "*            Installation Process Start         *";
ui_print "*************************************************";
ui_print "*   extracting boot and modem to /tmp/backup    *";
mkdir /tmp/backup
dd if=/dev/block/by-name/boot$(getprop ro.boot.slot_suffix) of=/tmp/backup/boot.img
dd if=/dev/block/by-name/fsc of=/tmp/backup/fsc
dd if=/dev/block/by-name/fsg of=/tmp/backup/fsg
dd if=/dev/block/by-name/modemst1 of=/tmp/backup/modemst1
dd if=/dev/block/by-name/modemst2 of=/tmp/backup/modemst2
ui_print "*               Unmounting Partition            *";
umount /dev/block/by-name/win
umount /dev/block/by-name/pe
sleep 1
ui_print "*************************************************";
ui_print "*                Formating Partition            *";
mkfs.fat -F32 -s1 /dev/block/by-name/esp -n ESP
mkfs.ntfs -f /dev/block/by-name/win -L WIN
sleep 1
ui_print "*************************************************";
ui_print "*               Mounting Partition              *";
mkdir /tmp/win
mkdir /tmp/esp
mount.ntfs /dev/block/by-name/win /tmp/win
mount /dev/block/by-name/esp /tmp/esp
sleep 1
ui_print "*************************************************";
ui_print "*              Copy Installation File           *";
mkdir /tmp/win/installer
mkdir /mnt/win/installer/Driver
package_extract_file "Driver.zip" "/tmp/win/installer/Driver.zip";
package_extract_file "WinPE.zip" "/tmp/win/installer/WinPE.zip";
package_extract_file "uefi.img" "/tmp/win/installer/uefi.img";
package_extract_file "install.esd" "/tmp/win/installer/install.esd";
package_extract_file "winactivator.bat" "/tmp/win/winactivator.bat";
package_extract_file "install.bat" "/tmp/win/installer/install.bat";
package_extract_file "install2.bat" "/tmp/win/installer/install2.bat";
unzip /tmp/win/installer/WinPE.zip -d /tmp/esp
unzip /tmp/win/installer/Driver.zip -d /tmp/win/installer
sleep 1
ui_print "*************************************************";
ui_print "*     flashing uefi image to boot partition     *";
cp -r -n /tmp/backup /tmp/win
cp /sdcard/boot.img -d /tmp/win/boot.img
rm //sdcard/UEFI/*.img
cp /tmp/win/installer/uefi.img -d /sdcard/UEFI/uefi.img
dd if=/tmp/win/installer/uefi.img of=/dev/block/by-name/boot$(getprop ro.boot.slot_suffix)
sleep 1
ui_print "*************************************************";
ui_print "*               Flashing Completed              *";
ui_print "*                                               *";
ui_print "*save backup folder from phone to SdCard/PenDriv*";
ui_print "*                                               *";
ui_print "*           rebooting in 10 sec and             *";
ui_print "*                                               *";
ui_print "*     Installation will start automaticly       *";
ui_print "*                                               *";
ui_print "*  If Installation Failed, Don't Flash it again *";
ui_print "*                                               *";
ui_print "*         ask for help on Telegram Chat         *";
ui_print "*                                               *";
ui_print "*************************************************";
sleep 10
reboot
